<!doctype html>
<html lang="sk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Aktuálne hráme</title>
<style>
  body{font-family:system-ui,Arial,sans-serif;background:#0e0e0e;color:#eee;margin:0;padding:2rem}
  button{padding:.8rem 1.2rem;border:0;border-radius:12px;font-size:1rem;cursor:pointer}
  .card{margin-top:1rem;padding:1rem 1.2rem;border-radius:16px;background:#1b1b1b}
  .muted{color:#9aa0a6}
</style>
</head>
<body>
  <h1>Aktuálne hráme</h1>
  <p class="muted">Tlačidlo volá /now na tvojom backend-e (Render).</p>

  <input id="api" style="width:450px" placeholder="https://tvoje-app.onrender.com/now"/>
  <button id="btn">Zistiť teraz</button>

  <div id="out" class="card" hidden></div>

<script>
  const api = document.getElementById('api');
  const btn = document.getElementById('btn');
  const out = document.getElementById('out');

  const API = 'https://melody-now.onrender.com/now';
  api.value = API;                    // predvyplní input
  window.addEventListener('DOMContentLoaded', () => btn.click());

  btn.onclick = async () => {
    const url = api.value.trim();
    if(!url) { alert("Doplň URL endpointu /now"); return; }
    btn.disabled = true; btn.textContent = "Načítavam...";
    try {
      const r = await fetch(url, {cache:'no-store'});
      const d = await r.json();
      if (d.error) throw new Error(d.error);
      out.hidden = false;
      out.innerHTML = `
        <div style="font-size:1.2rem;margin-bottom:.3rem">🎵
          <strong>${d.artist}</strong> — ${d.title}
        </div>
        <div class="muted">${d.date} ${d.time} · odhad počúvanosti:
          <strong>${Number(d.listeners).toLocaleString('sk-SK')}</strong>
        </div>`;
    } catch(e) {
      out.hidden = false;
      out.innerHTML = `<span style="color:#ffb4b4">Chyba: ${e.message}</span>`;
    } finally {
      btn.disabled = false; btn.textContent = "Zistiť teraz";
    }
  };
</script>
</body>
</html>
